---
title: "Model Options"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Model Options}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

A vareity of model options also need to be specified to ensure the projection model works as expected. Required options are:

* `removals_input`: input units of removals (either "catch" is inputs are a TAC, or "F" if an instantenous fishing mortality rate)
* `simulate_observations`: whethr to simulate observations from the OM (TRUE/FALSE)

```{r, base_model_options}
model_options <- list(
  removals_input = "catch",
  simulate_observations = TRUE
)
```

### Catch Apportionment
If `removals_input="catch"`, then region and fleet-level apportionment must also be specified: 

* `region_apportionment`: an unnamed list of vectors (of length `nyears`) specifying what proportion of the TAC should be allocated to each spatial region. There should be as many vector as there are regions. The sum across all regions in a given year should be 1.0, but the model will not make this check internally.

* `fleet_apportionment`: an unnamed list of vectors (of length `nyears`) specifying what proportion of the TAC should be allocated to each fishing fleet. There should be as many vectors as there are fishing fleets. For multi-region models, the `fleet_apportionment` proportions will be applied across all regions. There is not currently support for specifying unique fleet apportionments per spatial region. 

```{r apportionment_options, eval=FALSE}
# For a single region model, 100% of the catch is apportioned to the single region
model_options$regional_apportionment <- list(1)

# Define a 70%-30% apportionment split between fleet 1 and fleet 2
model_options$fleet_apportionment <- list(rep(0.70, nyears), rep(30, nyears))

```

### Observation Processes
If `simulate_observations=TRUE`, then a set of parameters that govern how observations are simulated must also be defined. This option, `obs_pars` is a list of vectors, where each vector has length `nfleets+nsurveys`.

Required items in the `obs_pars` list are:

* `is_survey`: indicates whether a given fleet is a fishing fleet or survey fleet (`0` indicates a fishing fleet, `1` indicates a scientific survey) 
* `qs`: catchability coefficients
* `rpn`: whether to generate a relative population number (RPN) index (`0` = no, `1` = yes)
* `rpw`: whether to generate a relative population weight (RPW) index (`0` = no, `1` = yes)
* `rpn_cv`: a coefficient of variation (CV) to use when generating RPN observations
* `rpw_cv`: a coefficient of variation (CV) to use when generating RPW observations
* `acs`: whether to generate age composition observations (`0` = no, `1` = yes)
* `ac_samps`: number of samples to use when generating age composition observations
* `ac_as_integers`: whether age composition observations should be provided as integers or proportions (`0` = no, `1` = yes)
* `acs_agg_sex`: whether age composition observations should be aggregated by sex (`0` = no, `1` = yes)

Below is an example `obs_pars` object that generates RPNs and RPWs for two surveys, and age composition observations for two fisheries and two surveys. Age compositions are not aggregated by sex and are returned as integers. 
```{r, eval=FALSE}
obs_pars <- list(
    # longline fishery, trawl fishery, longline survey, trawl survey
    is_survey   = c(0, 0, 1, 1),  # is this a survey (1) or fishery (0)
    qs          = c(1, 1, 6.41, 0.85), # catchability coefficient (q) for surveys
    rpn         = c(0, 0, 1, 1), # should RPNs be computed (yes=1, no=0)
    rpn_cv      = c(0, 0, 0.1, 0.1), # RPN CV
    rpw         = c(0, 0, 1, 1), # should RPWs be computed (yes=1, no=0)
    rpw_cv      = c(0, 0, 0.1, 0.1), # RPW CV
    acs         = c(1, 1, 1, 1), # should age compositions be computed (yes=1, no=0)
    ac_samps    = c(50, 30, 50, 30), # total sample size for age composition observations
    ac_as_integers  = c(TRUE, TRUE, TRUE, TRUE), # return age comps as integers (TRUE) or proportions (FALSE)
    acs_agg_sex     = c(FALSE, FALSE, FALSE, FALSE) # should age comps be aggregated by sex
)
```
Every item in the list object must have length `nfleets+nsurveys`, even if observations are not being generated for some fleets or surveys. In the above example, even though RPN and RPW indices are not being generated for the two fishing fleets, catchability coefficients (`qs`) and CVs (`rpn_cv` and `rpw_cv`) are stil defined for those two fisheries. The observation submodel ignores these values internally when the `simulate_observations()` function runs.

For items that 

For additional information on how all of these parameters are used to generate observations, see ["Observation Processes"](observation_processes.html).

### Default Options
A helper function, `setup_model_options()` will return a fully formed `model_options` list object with required parameters set to default values.

The default values are as follows:

* `removals_input`: "catch"
* `simulate_observations`: TRUE
* `region_apportionment`: 1/nregions
* `fleet_apportionment`: 1/nfleets

No default values are established for the `obs_pars` options at this time.