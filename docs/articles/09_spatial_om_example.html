<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Spatial Model Example • afscOM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Spatial Model Example">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">afscOM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/afscOM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_model_dimensions.html">Model Dimensions</a>
    </li>
    <li>
      <a href="../articles/02_specifying_demographic_parameters.html">Specifying Demographic Rates</a>
    </li>
    <li>
      <a href="../articles/03_recruitment.html">Recruitment</a>
    </li>
    <li>
      <a href="../articles/04_removals.html">Removals</a>
    </li>
    <li>
      <a href="../articles/05_model_options.html">Model Options</a>
    </li>
    <li>
      <a href="../articles/06_observation_processes.html">Observation Processes</a>
    </li>
    <li>
      <a href="../articles/07_multiyear_projections.html">Conducting Multiyear Projections</a>
    </li>
    <li>
      <a href="../articles/08_alaska_sablefish.html">A Spatial Model Example</a>
    </li>
    <li>
      <a href="../articles/09_spatial_om_example.html">A Spatial Model Example</a>
    </li>
    <li>
      <a href="../articles/10_nep_transboundary_sablefish.html">Example: Northeast Pacific Transboundary Sablefish Model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Spatial Model Example</h1>
            
      

      <div class="hidden name"><code>09_spatial_om_example.Rmd</code></div>

    </div>

    
    
<p>Here we describe how to build a simple spatial model based on the
demographic rates of Alaska sablefish. The example provided here is
meant to illustrate how to set up the different components (demographic
matrices, movement matrix, catch apportionment, etc.) of a
spatially-explicit model, but is not designed to replicate any specific
model outputs. Demographic parameters are derived from Goethel et
al. (2021), while movement matrices are derived from Hanselman et
al. (2018).</p>
<div class="section level3">
<h3 id="model-setup">Model Setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h3>
<p>Start by specifying the model dimensions, dimension names, and
obtaining default values for all model options:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">afscOM</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nyears</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">nages</span>  <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">nsexes</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">nregions</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">nfleets</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">nsurveys</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">dimension_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"time"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nyears</span>,</span>
<span>    <span class="st">"age"</span>  <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">31</span>,</span>
<span>    <span class="st">"sex"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>,</span>
<span>    <span class="st">"region"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EGOA"</span>, <span class="st">"CGOA"</span>, <span class="st">"WGOA"</span>, <span class="st">"BS"</span>, <span class="st">"AI"</span><span class="op">)</span>,</span>
<span>    <span class="st">"fleet"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fixed"</span>, <span class="st">"Trawl"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_model_params.html">set_model_params</a></span><span class="op">(</span><span class="va">nyears</span>, <span class="va">nages</span>, <span class="va">nsexes</span>, <span class="va">nregions</span>, <span class="va">nfleets</span><span class="op">)</span></span></code></pre></div>
<p>Next, specify demographic parameters matrices (for more information
see the vignette on “Specifying Demographic Parameters”).</p>
<p>In brief, the demographic parameters specified here define a
population with constant natural mortality across time, age, sex, and
region, age-specific maturity, and age-sex specific weight at age.
Selectivity differs across age, sex, and fleet for both fisheries and
surveys. Fishery retention is 1 across all ages and sexes, indicating
that no discarding occurs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assessment</span> <span class="op">&lt;-</span> <span class="va">sablefish_assessment_data</span></span>
<span></span>
<span><span class="co"># Mortality is constant across time, age, and region</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">0.113179</span></span>
<span><span class="va">mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">M</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 50-50 sex ratio across all times and regions</span></span>
<span><span class="va">prop_males</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">sexrat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">prop_males</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Full retention for all fisheries</span></span>
<span><span class="va">retention</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">retention</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, include_fleet_dim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No discard mortality as no discarding is allowed</span></span>
<span><span class="va">discard</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span><span class="va">dmr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">discard</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, include_fleet_dim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Maturity varies by age</span></span>
<span><span class="va">maturity</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">growthmat</span><span class="op">[</span>, <span class="st">"mage.block1"</span><span class="op">]</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">maturity</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, by<span class="op">=</span><span class="st">"age"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Weight varies by age and sex</span></span>
<span><span class="va">weight_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">nages</span>, ncol<span class="op">=</span><span class="va">nsexes</span>, dimnames<span class="op">=</span><span class="va">dimension_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">weight_mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">growthmat</span><span class="op">[</span>, <span class="st">"wt.f.block1"</span><span class="op">]</span></span>
<span><span class="va">weight_mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">growthmat</span><span class="op">[</span>, <span class="st">"wt.m.block1"</span><span class="op">]</span></span>
<span><span class="va">waa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">weight_mat</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fishery and Survey selectivity vaies by age, sex, and fleet</span></span>
<span><span class="va">selex_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nages</span>, <span class="va">nsexes</span>, <span class="va">nfleets</span><span class="op">)</span>, dimnames<span class="op">=</span><span class="va">dimension_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"fleet"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">selex_mat</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"fish1sel.f"</span><span class="op">]</span></span>
<span><span class="va">selex_mat</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"fish1sel.m"</span><span class="op">]</span></span>
<span><span class="va">selex_mat</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"fish3sel.f"</span><span class="op">]</span></span>
<span><span class="va">selex_mat</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"fish3sel.m"</span><span class="op">]</span></span>
<span><span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">selex_mat</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"fleet"</span><span class="op">)</span>, include_fleet_dim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">survey_selex_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nages</span>, <span class="va">nsexes</span>, <span class="fl">2</span><span class="op">)</span>, dimnames<span class="op">=</span><span class="va">dimension_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"fleet"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">survey_selex_mat</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"srv1sel.f"</span><span class="op">]</span></span>
<span><span class="va">survey_selex_mat</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"srv1sel.m"</span><span class="op">]</span></span>
<span><span class="va">survey_selex_mat</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"srv7sel.f"</span><span class="op">]</span></span>
<span><span class="va">survey_selex_mat</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">agesel</span><span class="op">[</span>,<span class="st">"srv7sel.m"</span><span class="op">]</span></span>
<span><span class="va">survey_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_param_matrix.html">generate_param_matrix</a></span><span class="op">(</span><span class="va">survey_selex_mat</span>, dimension_names <span class="op">=</span> <span class="va">dimension_names</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"fleet"</span><span class="op">)</span>, include_fleet_dim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Movement is defined based on estimates from Hanselman et al. (2018)
that were derived from a long term tagging study. Movement is age and
sex specific, but is not unique across all ages. Instead, ages are
grouped together based loosely on the size of individuals at that age,
and a unique movement matrix is defined for “small”, “medium”, and
“large” fish (see Hanselman et al. 2018 for details). The rows of the
movement matrix indicate the source region and the columns indicating
the destination regions for individuals in each time step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Movement matrices from Hanselman et al. 2018</span></span>
<span><span class="va">small_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">0.503</span>, <span class="fl">0.294</span>, <span class="fl">0.127</span>, <span class="fl">0.021</span>, <span class="fl">0.019</span>, </span>
<span>        <span class="fl">0.372</span>, <span class="fl">0.325</span>, <span class="fl">0.180</span>, <span class="fl">0.057</span>, <span class="fl">0.053</span>, </span>
<span>        <span class="fl">0.271</span>, <span class="fl">0.304</span>, <span class="fl">0.196</span>, <span class="fl">0.112</span>, <span class="fl">0.110</span>,</span>
<span>        <span class="fl">0.070</span>, <span class="fl">0.148</span>, <span class="fl">0.172</span>, <span class="fl">0.567</span>, <span class="fl">0.042</span>,</span>
<span>        <span class="fl">0.038</span>, <span class="fl">0.085</span>, <span class="fl">0.105</span>, <span class="fl">0.049</span>, <span class="fl">0.722</span></span>
<span>    <span class="op">)</span>,</span>
<span>    nrow<span class="op">=</span><span class="va">nregions</span>, ncol<span class="op">=</span><span class="va">nregions</span>, byrow<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">small_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">small_movement</span>, <span class="fl">1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">medium_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">0.584</span>, <span class="fl">0.261</span>, <span class="fl">0.076</span>, <span class="fl">0.014</span>, <span class="fl">0.021</span>, </span>
<span>        <span class="fl">0.369</span>, <span class="fl">0.356</span>, <span class="fl">0.139</span>, <span class="fl">0.049</span>, <span class="fl">0.075</span>, </span>
<span>        <span class="fl">0.271</span>, <span class="fl">0.339</span>, <span class="fl">0.151</span>, <span class="fl">0.091</span>, <span class="fl">0.140</span>, </span>
<span>        <span class="fl">0.081</span>, <span class="fl">0.200</span>, <span class="fl">0.151</span>, <span class="fl">0.502</span>, <span class="fl">0.065</span>, </span>
<span>        <span class="fl">0.073</span>, <span class="fl">0.183</span>, <span class="fl">0.141</span>, <span class="fl">0.054</span>, <span class="fl">0.548</span></span>
<span>    <span class="op">)</span>,</span>
<span>    nrow<span class="op">=</span><span class="va">nregions</span>, ncol<span class="op">=</span><span class="va">nregions</span>, byrow<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">medium_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">medium_movement</span>, <span class="fl">2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">large_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>       <span class="fl">0.550</span>, <span class="fl">0.272</span>, <span class="fl">0.094</span>, <span class="fl">0.023</span>, <span class="fl">0.024</span>, </span>
<span>       <span class="fl">0.458</span>, <span class="fl">0.306</span>, <span class="fl">0.114</span>, <span class="fl">0.050</span>, <span class="fl">0.055</span>, </span>
<span>       <span class="fl">0.423</span>, <span class="fl">0.304</span>, <span class="fl">0.117</span>, <span class="fl">0.067</span>, <span class="fl">0.076</span>, </span>
<span>       <span class="fl">0.172</span>, <span class="fl">0.227</span>, <span class="fl">0.115</span>, <span class="fl">0.395</span>, <span class="fl">0.087</span>, </span>
<span>       <span class="fl">0.153</span>, <span class="fl">0.207</span>, <span class="fl">0.106</span>, <span class="fl">0.030</span>, <span class="fl">0.501</span> </span>
<span>    <span class="op">)</span>,</span>
<span>    nrow<span class="op">=</span><span class="va">nregions</span>, ncol<span class="op">=</span><span class="va">nregions</span>, byrow<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">large_movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">large_movement</span>, <span class="fl">2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">movement_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nregions</span>, <span class="va">nregions</span>, <span class="va">nyears</span>, <span class="va">nages</span>, <span class="va">nsexes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">movement_matrix</span><span class="op">[</span>,,,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">small_movement</span></span>
<span><span class="va">movement_matrix</span><span class="op">[</span>,,,<span class="fl">4</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">medium_movement</span></span>
<span><span class="va">movement_matrix</span><span class="op">[</span>,,,<span class="fl">7</span><span class="op">:</span><span class="va">nages</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">large_movement</span></span></code></pre></div>
<p>All demographic matrices are added to a list object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    waa<span class="op">=</span><span class="va">waa</span>,</span>
<span>    mat<span class="op">=</span><span class="va">mat</span>,</span>
<span>    mort<span class="op">=</span><span class="va">mort</span>,</span>
<span>    sexrat<span class="op">=</span><span class="va">sexrat</span>,</span>
<span>    sel<span class="op">=</span><span class="va">sel</span>,</span>
<span>    ret<span class="op">=</span><span class="va">ret</span>,</span>
<span>    dmr<span class="op">=</span><span class="va">dmr</span>,</span>
<span>    surv_sel<span class="op">=</span><span class="va">survey_sel</span>,</span>
<span>    movement<span class="op">=</span><span class="va">movement_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>An initial numbers-at-age matrix is defined as is a timeseries of
global recruitment. Global annual recruitment will be apportioned to
individual regions equally (as is the default behavior).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_naa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nages</span>, <span class="va">nsexes</span>, <span class="va">nregions</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">31</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EGOA"</span>, <span class="st">"CGOA"</span>, <span class="st">"WGOA"</span>, <span class="st">"BS"</span>, <span class="st">"AI"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">init_naa</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">natage.female</span><span class="op">[</span><span class="st">"1960"</span>,<span class="op">]</span><span class="op">/</span><span class="va">nregions</span></span>
<span><span class="va">init_naa</span><span class="op">[</span>,,<span class="fl">2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">natage.male</span><span class="op">[</span><span class="st">"1960"</span>,<span class="op">]</span><span class="op">/</span><span class="va">nregions</span></span>
<span></span>
<span><span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="va">assessment</span><span class="op">$</span><span class="va">natage.female</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">recruitment</span>, size<span class="op">=</span><span class="va">nyears</span><span class="op">+</span><span class="fl">1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="catch-apportionment">Catch Apportionment<a class="anchor" aria-label="anchor" href="#catch-apportionment"></a>
</h3>
<p>An annual catch timeseries applicable to the entire model is defined
as a vector (20mt of catch each year). Separate matrices define the
proportion of the global catch that is apportioned to each spatial
region (dimension <code>[nyears, nregions]</code>), and the proportion
of each regional catch that is apportioned to each fishing fleet
(dimension <code>[nyears, nfleets, nregions]</code>). Here, catch is
divided equally amongst each spatial region, and fleet-specific catch is
allocated 80% to fleet 1 and 20% to fleet 2.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catch_timeseries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">nyears</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">nyears</span><span class="op">)</span></span>
<span><span class="va">regional_catch_aportionment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">nregions</span>, nrow<span class="op">=</span><span class="va">nyears</span>, ncol<span class="op">=</span><span class="va">nregions</span><span class="op">)</span></span>
<span><span class="va">region_fleet_catch_apportionment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nyears</span>, <span class="va">nfleets</span>, <span class="va">nregions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">region_fleet_catch_apportionment</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.80</span></span>
<span><span class="va">region_fleet_catch_apportionment</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.20</span></span></code></pre></div>
<p>The apportionment matrices are added to the
<code>model_options</code> list:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        removals_input <span class="op">=</span> <span class="st">"catch"</span>,</span>
<span>        simulate_observations <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        fleet_apportionment <span class="op">=</span> <span class="va">region_fleet_catch_apportionment</span>,</span>
<span>        recruit_apportionment <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        recruit_apportionment_random <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        do_recruits_move <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-the-model">Run the Model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h3>
<p>Now, the model is projected forward with the following call:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span></span>
<span>    init_naa <span class="op">=</span> <span class="va">init_naa</span>, </span>
<span>    removals_timeseries <span class="op">=</span> <span class="va">catch_timeseries</span>,</span>
<span>    recruitment <span class="op">=</span> <span class="va">recruitment</span>, </span>
<span>    dem_params <span class="op">=</span> <span class="va">dem_params</span>, </span>
<span>    nyears <span class="op">=</span> <span class="va">nyears</span>, </span>
<span>    model_options <span class="op">=</span> <span class="va">model_options</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process-model-results">Process Model Results<a class="anchor" aria-label="anchor" href="#process-model-results"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssb</span> <span class="op">&lt;-</span> <span class="fu">afscOM</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_ssb.html">compute_ssb</a></span><span class="op">(</span><span class="va">om1</span><span class="op">$</span><span class="va">naa</span>, <span class="va">dem_params</span><span class="op">)</span></span>
<span><span class="va">bio</span> <span class="op">&lt;-</span> <span class="fu">afscOM</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_bio.html">compute_bio</a></span><span class="op">(</span><span class="va">om1</span><span class="op">$</span><span class="va">naa</span>, <span class="va">dem_params</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_ssb.html">plot_ssb</a></span><span class="op">(</span><span class="va">ssb</span><span class="op">)</span></span></code></pre></div>
<p><img src="09_spatial_om_example_files/figure-html/model_results-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bio.html">plot_bio</a></span><span class="op">(</span><span class="va">bio</span><span class="op">)</span></span></code></pre></div>
<p><img src="09_spatial_om_example_files/figure-html/model_results-2.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Benjamin Williams, Joshua Zahner, Matt Cheng, Maia Kapur.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
