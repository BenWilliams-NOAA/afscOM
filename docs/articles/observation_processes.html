<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Observation Processes • afscOM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Observation Processes">
<meta property="og:description" content="afscOM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">afscOM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/afscOM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_dimensions.html">Model Dimensions</a>
    </li>
    <li>
      <a href="../articles/model_options.html">Model Options</a>
    </li>
    <li>
      <a href="../articles/multiyear_projections.html">Conducting Multiyear Projections</a>
    </li>
    <li>
      <a href="../articles/observation_processes.html">Observation Processes</a>
    </li>
    <li>
      <a href="../articles/specifying_demographic_parameters.html">Specifying Demographic Rates</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Observation Processes</h1>
            
      
      
      <div class="hidden name"><code>observation_processes.Rmd</code></div>

    </div>

    
    
<p>Users can optionally request for <code>afscOM</code> to simulate observations from fishery catch or scientific surveys, by specifying <code>simulate_observations=TRUE</code> in the <code>model_options</code> list object. The observation submodel is currently developed based on surveys used by NOAA AFSC assessment scientists, but may be generalized in the future.</p>
<p><em>NOTE: The observation submodel has not been tested when the model contains multiple spatial regions.</em></p>
<div class="section level4">
<h4 id="scientific-surveys">Scientific Surveys<a class="anchor" aria-label="anchor" href="#scientific-surveys"></a>
</h4>
<p>The observation submodel generates relative population number (RPN) abundance indices, relative population weight (RPW) abundance indices, and age composition data from two scientific surveys: the Alaska longline survey [<em>citation</em>] and the NOAA bottom trawl survey [<em>citation</em>]. Data generated from each survey is representative of the entire coastwide population (even though some regions of Alaska are only sampled by the longline survey occur in alternating years). Surveys are assumed to occur halfay through the projection year, and survey catches are not removed from the population.</p>
<p>Abundance indices (RPNs and RPWs) are log-normally distributed. For RPNs, the predicted abundance index is:</p>
<p><span class="math inline">\(I_y = q^{ll}\sum{N_{y,a,s}\exp{(-Z_{y,a,s}/2})v^{ll}_{y,a,s}}\)</span></p>
<p>And for RPWs is:</p>
<p><span class="math inline">\(I_y = q^{trwl}\sum{N_{y,a,s}\exp{(-Z_{y,a,s}/2})v^{trwl}_{y,a,s}w_{y,a,s}}\)</span>.</p>
<p>For both surveys <span class="math inline">\(q\)</span> represents the catchability coefficient for the specific survey and <span class="math inline">\(v\)</span> represents the survey selectivity. For RPWs, <span class="math inline">\(w\)</span> represents weight-at-age-and-sex. R functions for computing RPNs and RPWs according to the above equations are available as <code><a href="../reference/simulate_rpn.html">simulate_rpn()</a></code> and <code><a href="../reference/simulate_rpw.html">simulate_rpw()</a></code>.</p>
<p>Observations are lognorally distributed around the predicted log abundance index (i.e. <span class="math inline">\(log(I_y)\)</span>). Lognormal observations are bias-corrected to ensure that the log-mean and arithemtic-mean are consistent. Users must specify a coefficient of variation (CV) for abundance index observations for each survey. The underlying function that yields lognormal observations is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pred is the predicted abudnance index as described above</span></span>
<span><span class="co"># cv is a user input model_option</span></span>
<span><span class="va">simulate_lognormal_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pred</span>, <span class="va">cv</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">sds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">cv</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">1</span>, meanlog<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="va">sds</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, sdlog <span class="op">=</span> <span class="va">sds</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Age composition data is multinomially distributed. Predicted age compositions are calculated as the proportion of the population that is each age (e.g. <span class="math inline">\(p_y = N_{y,a,s}/\sum_a{N_{y,a,s}}\)</span>). Users can, optionally, specify whether age composition data should be generate in a sex-aggregated or sex-disaggregated (the default) fashion. Is disaggregated comps are requested, prediction compoistions represent the proportion of population in each age, of each sex. An R function for computing age composition predictions is available as <code><a href="../reference/simulate_ac.html">simulate_ac()</a></code>.</p>
<p>Observations are multinomially distributed about the prediction age compositions. A user supplied number of multinomially samples (<span class="math inline">\(n\)</span>) regulates how many random draws are taken from the multinomial distribution. Users can specify if the returned observations are in proportions, or integer format (which is necesarry for some estimation models), through the <code>as_integers</code> model option. As with the predictions, observations can be either sex-aggregated or sex-disaggregated (the default). An optional aging error matrix can also be applied to observation (<em>though this hs not been thoroughly tested</em>). The underlying function that yields multinomial observations is as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulate_multinomial_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pred</span>, <span class="va">samp_size</span>, <span class="va">aggregate_sex</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">as_integers</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">age_err</span><span class="op">=</span><span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">pred</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">p</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="co"># [...]</span></span>
<span>        <span class="va">multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">samp_size</span>, prob<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span>                <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">as_integers</span><span class="op">)</span><span class="op">{</span></span>
<span>                    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span></span>
<span>                <span class="co"># Include aging error if available</span></span>
<span>                <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age_err</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>                    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">tmp</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">age_err</span></span>
<span>                <span class="op">}</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span>            <span class="op">}</span><span class="op">)</span></span>
<span>        <span class="co"># [...]</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">multi</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fisheries-data">Fisheries Data<a class="anchor" aria-label="anchor" href="#fisheries-data"></a>
</h4>
<p>At present, only catch-at-age data is generated from fisheries catch. The age composition data is generated in same way as for surveys, except that data is representative of catch-at-age from the whole system ratherthan population numbers-at-age. An R function for computing predicted catch-at-age observations is available as <code><a href="../reference/simulate_caa.html">simulate_caa()</a></code>. Like with survey age compositions, fisheries catch-at-age is multinomially distributed.</p>
</div>
<div class="section level4">
<h4 id="custom-observation-processes">Custom Observation Processes<a class="anchor" aria-label="anchor" href="#custom-observation-processes"></a>
</h4>
<p>The observation submodels currently built-in to <code>afcsOM</code> is designed to emulate common data sources and data types for NOAA stock assessment biologists, but does not cover the full scope of possible observation data types. For example, this is not currently support for generating fishery CPUE indices or egg productions indices. For more complex observation processes, users can author custom observation submodels to generate additional data.</p>
<p>To implement a custom observation submodel, turn off the defalt observation model by setting <code>model_options$simulate_observations=FALSE</code> (this ensures that the <code>project</code> function wont generate its own observations). From there, you can define any type of function necesarry, and provide, as input, outputs from the <code><a href="../reference/project.html">project()</a></code> function. For example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_options</span><span class="op">$</span><span class="va">obs_pars</span><span class="op">$</span><span class="va">sex_rat</span><span class="op">$</span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">custom_observation_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">naa</span>, <span class="va">model_options</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># return observations of population sex-ratio </span></span>
<span>    <span class="va">n_males</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">2</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">n_females</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span> </span>
<span>    <span class="va">true_prop_males</span> <span class="op">&lt;-</span> <span class="va">n_males</span><span class="op">/</span><span class="op">(</span><span class="va">n_males</span><span class="op">+</span><span class="va">n_females</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># assume its normally distributed (should be a better assumption, since its a proportion)</span></span>
<span>    <span class="va">obs_prop_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean<span class="op">=</span><span class="va">true_prop_males</span>, sd<span class="op">=</span><span class="va">model_options</span><span class="op">$</span><span class="va">obs_pars</span><span class="op">$</span><span class="va">sex_rat</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">obs_prop_males</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_options</span><span class="op">$</span><span class="va">simulate_observations</span> <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># turn off default simulations</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">removals</span>, <span class="va">fleet.props</span>, <span class="va">dem_params</span>, <span class="va">prev_naa</span>, <span class="va">recruitment</span>, options<span class="op">=</span><span class="va">model_options</span><span class="op">)</span></span>
<span></span>
<span><span class="va">naa</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">naa_tmp</span></span>
<span><span class="va">propmale_obs</span> <span class="op">&lt;-</span> <span class="fu">custom_observation_process</span><span class="op">(</span><span class="va">naa</span>, <span class="va">model_options</span><span class="op">)</span></span></code></pre></div>
<p>If users want to simply augment the current set of observations (as is being done in the above example), setting <code>model_options$simulate_observations=FALSE</code> is not strictly necesarry.</p>
<p>For multiyear simulations, users will need to implement their own multiyear simulation framework with the custom observation model. See the <a href="multiyear_projections.html">“Multiyear Projections”</a> page for additional information.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joshua Zahner, Benjamin Williams, Matt Cheng, Dan Goethel, Curry Cunningham.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
